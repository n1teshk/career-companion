<div class="page-header">
  <h1 class="page-title">Review your Cover Letter and Video Pitch</h1>
  <h2 class="page-subtitle">
    Please review the draft cover letter and video pitch. Regenerate to get more options
  </h2>
</div>

<div class="container-fluid" data-controller="overview">
  <div class="d-flex justify-content-center">
    <div class="d-flex flex-column" style="max-width: 1400px; width: 100%;">

      <div class="d-flex gap-4 justify-content-center align-items-start">
        <div class="d-flex flex-column gap-4" style="flex: 0 0 20%; max-width: 20%; min-width: 200px;">
          <div class="d-flex flex-column p-4 rounded-4 shadow bg-white border" style="height: 500px;">
            <h2 class="h5 mb-4 text-center"><strong>Your Selections</strong></h2>
            <div class="d-flex flex-column flex-grow-1">
              <div class="flex-grow-1 p-2 overflow-auto">
                <% @trait_presenter.trait_data.each do |trait_item| %>
                  <div class="mb-3">
                    <h6 class="small text-muted mb-2"><%= trait_item[:label] %></h6>
                    <p class="small mb-0"><%= trait_item[:value] %></p>
                  </div>
                  <hr class="my-3" style="border-color: #e0e0e0;">
                <% end %>
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex flex-column p-4 rounded-4 shadow bg-white border" style="flex: 0 0 38.25%; max-width: 38.25%; height: 500px;">
          <h2 class="h5 mb-4 text-center"><strong>Review your Cover Letter</strong></h2>
          <div class="d-flex flex-column" style="flex: 1; min-height: 0;">
            <div
              id="cl_output"
              class="p-2 overflow-auto flex-grow-1"
              data-overview-target="coverLetterOutput"
            >
              <%= simple_format(@application.cl_message) %>
            </div>
            <div class="row g-2 mt-auto" style="flex-shrink: 0;">
              <div class="col-6">
                <%= button_to "Regenerate", generate_cl_application_path(@application, prompt_cl: @llm_prompt_cl),
                  method: :post,
                  class: "btn btn-outline-secondary w-100 m-1" %>
              </div>
              <div class="col-6">
                <%= form_with url: final_cl_application_path(@application), method: :post, data: { action: "submit->overview#finalizeCoverLetter" }, class: "w-100" do |form| %>
                  <%= form.hidden_field :final_cl, data: { overview_target: "coverLetterInput" } %>
                  <%
                    cl_finalized = @application.finals.last&.cl.present?
                    cl_btn_class = cl_finalized ? "btn btn-success w-100 m-1" : "btn btn-primary w-100 m-1"
                    cl_btn_text = cl_finalized ? "Finalized" : "Finalize"
                    cl_disabled = cl_finalized
                  %>
                  <%= form.submit cl_btn_text,
                      class: cl_btn_class,
                      disabled: cl_disabled,
                      data: {
                        overview_target: "coverLetterFinalizeBtn",
                        finalized: cl_finalized.to_s
                      } %>
                <% end %>
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex flex-column p-4 rounded-4 shadow bg-white border" style="flex: 0 0 38.25%; max-width: 38.25%; height: 500px;">
          <h2 class="h5 mb-4 text-center"><strong>Review your Video Pitch</strong></h2>
          <div class="d-flex flex-column" style="flex: 1; min-height: 0;">
            <div
              id="video_output"
              class="p-2 overflow-auto flex-grow-1"
              data-overview-target="videoPitchOutput"
            >
              <%= simple_format(@application.video_message) %>
            </div>
            <div class="row g-2 mt-auto" style="flex-shrink: 0;">
              <div class="col-6">
                <%= button_to "Regenerate", generate_video_application_path(@application, prompt_video: @llm_prompt_video),
                  method: :post,
                  class: "btn btn-outline-secondary w-100 m-1" %>
              </div>
              <div class="col-6">
                <%= form_with url: final_pitch_application_path(@application), method: :post, data: { action: "submit->overview#finalizeVideoPitch" }, class: "w-100" do |form| %>
                  <%= form.hidden_field :final_pitch, data: { overview_target: "videoPitchInput" } %>
                  <%
                    pitch_finalized = @application.finals.last&.pitch.present?
                    pitch_btn_class = pitch_finalized ? "btn btn-success w-100 m-1" : "btn btn-primary w-100 m-1"
                    pitch_btn_text = pitch_finalized ? "Finalized" : "Finalize"
                    pitch_disabled = pitch_finalized
                  %>
                  <%= form.submit pitch_btn_text,
                      class: pitch_btn_class,
                      disabled: pitch_disabled,
                      data: {
                        overview_target: "videoPitchFinalizeBtn",
                        finalized: pitch_finalized.to_s
                      } %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

    <div class="d-flex justify-content-center align-items-center gap-3" style="padding-top: 3rem; padding-bottom: 3rem;">
    <%= link_to "← Back", trait_application_path(@application), class: "next-button" %>
    <%= link_to "Record Your Video →", video_page_application_path(@application),
      class: "next-button disabled-state",
      data: { overview_target: "finalButton", action: "click->overview#checkFinalized" } %>
  </div>
</div>

            <div class="pb-3"></div>
